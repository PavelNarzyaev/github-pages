window.__require=function t(e,o,r){function n(c,s){if(!o[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var p="function"==typeof __require&&__require;if(!s&&p)return p(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+c+"'")}}var l=o[c]={exports:{}};e[c][0].call(l.exports,function(t){return n(e[c][1][t]||t)},l,l.exports,t,e,o,r)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<r.length;c++)n(r[c]);return n}({BlocksManager:[function(t,e,o){"use strict";cc._RF.push(e,"7eacbj9PCxHOJRvZpeuI7VO","BlocksManager"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function t(){this.grid={},this.animatedBlocks={}}return t.prototype.registerBlockInGrid=function(t){this.grid[this.getGridKey(t.column,t.row)]=t},t.prototype.getBlockFromGrid=function(t,e){return this.grid[this.getGridKey(t,e)]},t.prototype.unregisterBlockFromGrid=function(t){this.grid[this.getGridKey(t.column,t.row)]==t&&delete this.grid[this.getGridKey(t.column,t.row)]},t.prototype.calculateGroupByBlock=function(t){var e,o=[t],r=((e={})[this.getGridKey(t.column,t.row)]=!0,e),n=function(t){i.bind(this)(t.column-1,t.row),i.bind(this)(t.column+1,t.row),i.bind(this)(t.column,t.row-1),i.bind(this)(t.column,t.row+1)},i=function(e,i){var c=this.getGridKey(e,i);if(!r[c]){r[c]=!0;var s=this.grid[c];s&&s.prefabIndex==t.prefabIndex&&!this.blockIsAnimated(s)&&(o.push(s),n.bind(this)(s))}};return n.bind(this)(t),o},t.prototype.iterateGridBlocks=function(t,e){for(var o in this.grid)t.apply(e,[this.grid[o]])},t.prototype.getGridKey=function(t,e){return t+"x"+e},t.prototype.registerAnimatedBlock=function(t){this.animatedBlocks[t.getId()]=t},t.prototype.unregisterAnimatedBlock=function(t){delete this.animatedBlocks[t.getId()]},t.prototype.blockIsAnimated=function(t){return this.animatedBlocks.hasOwnProperty(t.getId())},t.prototype.iterateAnimatedBlocks=function(t,e){for(var o in this.animatedBlocks)t.apply(e,[this.animatedBlocks[o]])},t}();o.default=r,cc._RF.pop()},{}],Block:[function(t,e,o){"use strict";cc._RF.push(e,"d4dfe0FEddOeoiFB2PRg0QR","Block");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function e(){var o=t.call(this)||this;return e.createdBlocksCounter++,o.id=e.createdBlocksCounter,o.prefabIndex=Math.floor(Math.random()*e.prefabs.length),o.node=cc.instantiate(e.prefabs[o.prefabIndex]),o.addChild(o.node),o}return r(e,t),e.prototype.getNode=function(){return this.node},e.prototype.getId=function(){return this.id},e.createdBlocksCounter=0,e}(cc.Node);o.default=n,cc._RF.pop()},{}],Field:[function(t,e,o){"use strict";cc._RF.push(e,"2cb393i8m9MA62whgRWgdmE","Field");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Block"),c=t("./GameModel"),s=t("./BlocksManager"),a=cc._decorator,p=a.ccclass,l=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.blocksMovingSpeed=100,e.columnsNum=5,e.rowsNum=5,e.minGroupSize=2,e.prefabSize=171,e.viewport=null,e.blocksPrefabs=[],e.particlePrefab=null,e}return r(e,t),e.prototype.alignNode=function(){var t=this.prefabSize*this.columnsNum,e=this.prefabSize*this.rowsNum;this.node.width=t+this.calculateViewportHorizontalMargins(),this.node.height=e+this.calculateViewportVerticalMargins()},e.prototype.start=function(){i.default.prefabs=this.blocksPrefabs,this.blocksManager=new s.default,this.fillViewport()},e.prototype.fillViewport=function(){for(var t=0;t<this.rowsNum;t++)for(var e=0;e<this.columnsNum;e++)this.createBlock(this.prefabSize*e,this.prefabSize*t,e,t)},e.prototype.createBlock=function(t,e,o,r,n){void 0===n&&(n=!1);var c=new i.default;c.x=t,c.y=e,c.column=o,c.row=r,this.blocksManager.registerBlockInGrid(c),n&&this.blocksManager.registerAnimatedBlock(c),this.viewport.addChild(c),c.getNode().on(cc.Node.EventType.TOUCH_START,function(){this.onBlockTouch(c)},this)},e.prototype.onBlockTouch=function(t){if(!this.blocksManager.blockIsAnimated(t)){var e=this.blocksManager.calculateGroupByBlock(t);if(e.length>=this.minGroupSize){c.default.move(e.length);for(var o={},r=0;r<e.length;){var n=e[r];this.removeBlock(n),this.refreshAnimations(n),o[n.column]?o[n.column]++:o[n.column]=1,r++}this.createTopBlocks(o),this.showGroupRemovingAnimation(e)}}},e.prototype.removeBlock=function(t){this.blocksManager.unregisterAnimatedBlock(t),this.blocksManager.unregisterBlockFromGrid(t),t.parent.removeChild(t),this.removeBlockListeners(t)},e.prototype.showGroupRemovingAnimation=function(t){for(var e=0;e<t.length;){var o=t[e];this.showBlockRemovingAnimation(o),e++}},e.prototype.showBlockRemovingAnimation=function(t){var e=cc.instantiate(this.particlePrefab);e.x=this.viewport.x+(t.x+this.prefabSize/2),e.y=this.viewport.y+(t.y+this.prefabSize/2),this.node.addChild(e);var o=e.getComponent(cc.ParticleSystem);o.custom=!0,o.autoRemoveOnFinish=!0,o.emitterMode=cc.ParticleSystem.EmitterMode.GRAVITY,o.duration=.1,o.life=.5,o.emissionRate=300,o.speed=20,o.angleVar=180,o.posVar=new cc.Vec2(this.prefabSize*this.node.scale/2,this.prefabSize*this.node.scale/2),o.gravity=new cc.Vec2(0,-500)},e.prototype.refreshAnimations=function(t){for(var e=t.row;e<this.rowsNum;e++){var o=this.blocksManager.getBlockFromGrid(t.column,e);o&&(this.blocksManager.unregisterBlockFromGrid(o),o.row--,this.blocksManager.registerBlockInGrid(o),this.blocksManager.registerAnimatedBlock(o))}},e.prototype.createTopBlocks=function(t){for(var e in t)for(var o=0;o<t[e];){var r=this.rowsNum-t[e]+o,n=this.blocksManager.getBlockFromGrid(Number(e),r-1),i=this.viewport.height,c=n?Math.max(n.y+this.prefabSize,i):i;this.createBlock(Number(e)*this.prefabSize,c,Number(e),r,!0),o++}},e.prototype.update=function(t){this.blocksManager.iterateAnimatedBlocks(function(e){var o=e.y-this.blocksMovingSpeed*t,r=e.row*this.prefabSize;o>r?e.y=o:(e.y=r,this.blocksManager.unregisterAnimatedBlock(e))},this)},e.prototype.onDestroy=function(){this.removeAllBlocksListeners()},e.prototype.removeAllBlocksListeners=function(){this.blocksManager.iterateGridBlocks(this.removeBlockListeners,this)},e.prototype.removeBlockListeners=function(t){t.getNode().off(cc.Node.EventType.TOUCH_START)},e.prototype.calculateViewportVerticalMargins=function(){var t=this.viewport.getComponent(cc.Widget);return t.top+t.bottom},e.prototype.calculateViewportHorizontalMargins=function(){var t=this.viewport.getComponent(cc.Widget);return t.left+t.right},n([l],e.prototype,"blocksMovingSpeed",void 0),n([l],e.prototype,"columnsNum",void 0),n([l],e.prototype,"rowsNum",void 0),n([l],e.prototype,"minGroupSize",void 0),n([l],e.prototype,"prefabSize",void 0),n([l(cc.Node)],e.prototype,"viewport",void 0),n([l([cc.Prefab])],e.prototype,"blocksPrefabs",void 0),n([l(cc.Prefab)],e.prototype,"particlePrefab",void 0),e=n([p],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./Block":"Block","./BlocksManager":"BlocksManager","./GameModel":"GameModel"}],GameModel:[function(t,e,o){"use strict";cc._RF.push(e,"67dca0d33tIw7Gz67WXtQ8p","GameModel"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function t(){}return t.init=function(t,e){this.remainingMoves=t,this.targetPoints=e,this.points=0,this.progress=0},t.getRemainingMoves=function(){return t.remainingMoves},t.getPoints=function(){return t.points},t.getProgress=function(){return t.progress},t.move=function(e){this.addPointsForGroup(e),this.remainingMoves--,cc.systemEvent.dispatchEvent(new cc.Event.EventCustom(t.MOVE_EVENT,!1))},t.addPointsForGroup=function(e){for(var o=0;e>1;)o+=10*e,e--;t.points+=o,t.progress=Math.min(t.points/t.targetPoints,1)},t.MOVE_EVENT="moveEvent",t.points=0,t.remainingMoves=0,t.targetPoints=0,t.progress=0,t}();o.default=r,cc._RF.pop()},{}],MainContainer:[function(t,e,o){"use strict";cc._RF.push(e,"33d05LDlRFFF5cS6Wjln5cY","MainContainer");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Field"),c=t("./Menu"),s=t("./Progress"),a=cc._decorator,p=a.ccclass,l=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.field=null,e.fieldFrameWidth=.5,e.fieldFrameHeight=.75,e.gapBetweenFieldAndMenu=.05,e.menu=null,e.menuFrameWidth=.35,e.menuFrameHeight=.5,e.progress=null,e.progressFrameWidth=.8,e.progressFrameHeight=.1,e}return r(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.SIZE_CHANGED,this.alignElements,this)},e.prototype.start=function(){this.field.alignNode(),this.alignElements()},e.prototype.alignElements=function(){this.field.node.scale=this.calculateNodeScale(this.field.node,this.fieldFrameWidth,this.fieldFrameHeight),this.menu.node.scale=this.calculateNodeScale(this.menu.node,this.menuFrameWidth,this.menuFrameHeight),this.progress.node.scale=this.calculateNodeScale(this.progress.node,this.progressFrameWidth,this.progressFrameHeight);var t=this.node.width*this.gapBetweenFieldAndMenu,e=this.field.node.width*this.field.node.scale+t+this.menu.node.width*this.menu.node.scale;this.field.node.x=(this.node.width-e)/2,this.menu.node.x=this.field.node.x+this.field.node.width*this.field.node.scale+t},e.prototype.calculateNodeScale=function(t,e,o){var r=this.node.width*e/t.width,n=this.node.height*o/t.height;return Math.min(r,n)},e.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.SIZE_CHANGED,this.alignElements,this)},n([l(i.default)],e.prototype,"field",void 0),n([l],e.prototype,"fieldFrameWidth",void 0),n([l],e.prototype,"fieldFrameHeight",void 0),n([l],e.prototype,"gapBetweenFieldAndMenu",void 0),n([l(c.default)],e.prototype,"menu",void 0),n([l],e.prototype,"menuFrameWidth",void 0),n([l],e.prototype,"menuFrameHeight",void 0),n([l(s.default)],e.prototype,"progress",void 0),n([l],e.prototype,"progressFrameWidth",void 0),n([l],e.prototype,"progressFrameHeight",void 0),e=n([p],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./Field":"Field","./Menu":"Menu","./Progress":"Progress"}],Menu:[function(t,e,o){"use strict";cc._RF.push(e,"a778fhHD0FHcpX1zu0CKkFV","Menu");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./GameModel"),c=cc._decorator,s=c.ccclass,a=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.movesLabel=null,e.scoresLabel=null,e}return r(e,t),e.prototype.onLoad=function(){cc.systemEvent.on(i.default.MOVE_EVENT,this.refresh,this)},e.prototype.start=function(){this.refresh()},e.prototype.refresh=function(){this.movesLabel.string=i.default.getRemainingMoves().toString(),this.scoresLabel.string=i.default.getPoints().toString()},e.prototype.onDestroy=function(){cc.systemEvent.off(i.default.MOVE_EVENT,this.refresh,this)},n([a(cc.Label)],e.prototype,"movesLabel",void 0),n([a(cc.Label)],e.prototype,"scoresLabel",void 0),e=n([s],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./GameModel":"GameModel"}],Model:[function(t,e,o){"use strict";cc._RF.push(e,"c3ef7QFladAHIifkXO0ngbE","Model"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function t(){}return t.win=!1,t}();o.default=r,cc._RF.pop()},{}],Progress:[function(t,e,o){"use strict";cc._RF.push(e,"e1458/HfXxAuZes3lDnxBmf","Progress");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./GameModel"),c=cc._decorator,s=c.ccclass,a=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bar=null,e.minBarWidth=53,e.maxBarWidth=756,e}return r(e,t),e.prototype.onLoad=function(){cc.systemEvent.on(i.default.MOVE_EVENT,this.refresh,this)},e.prototype.start=function(){this.refresh()},e.prototype.refresh=function(){this.bar.node.width=this.minBarWidth+(this.maxBarWidth-this.minBarWidth)*i.default.getProgress()},e.prototype.onDestroy=function(){cc.systemEvent.off(i.default.MOVE_EVENT,this.refresh,this)},n([a(cc.Sprite)],e.prototype,"bar",void 0),n([a],e.prototype,"minBarWidth",void 0),n([a],e.prototype,"maxBarWidth",void 0),e=n([s],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./GameModel":"GameModel"}],SceneFinish:[function(t,e,o){"use strict";cc._RF.push(e,"13e57etqh1CNrAkQU+nUp08","SceneFinish");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Model"),c=cc._decorator,s=c.ccclass,a=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return r(e,t),e.prototype.start=function(){i.default.win?this.label.string="You win!":this.label.string="You lose!"},e.prototype.onButtonAgainClick=function(){cc.director.loadScene("game")},n([a(cc.Label)],e.prototype,"label",void 0),e=n([s],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Model":"Model"}],SceneGame:[function(t,e,o){"use strict";cc._RF.push(e,"cc413KX5utAnZbo6+yCvhZf","SceneGame");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Model"),c=t("./GameModel"),s=cc._decorator,a=s.ccclass,p=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.movesLimit=10,e.targetPoints=2500,e}return r(e,t),e.prototype.onLoad=function(){cc.systemEvent.on(c.default.MOVE_EVENT,this.onMove,this)},e.prototype.start=function(){c.default.init(this.movesLimit,this.targetPoints)},e.prototype.onMove=function(){1==c.default.getProgress()?this.loadSceneFinish(!0):c.default.getRemainingMoves()<=0&&this.loadSceneFinish(!1)},e.prototype.loadSceneFinish=function(t){i.default.win=t,cc.director.loadScene("finish")},e.prototype.onDestroy=function(){cc.systemEvent.off(c.default.MOVE_EVENT,this.onMove,this)},n([p],e.prototype,"movesLimit",void 0),n([p],e.prototype,"targetPoints",void 0),e=n([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../Model":"Model","./GameModel":"GameModel"}],SceneStart:[function(t,e,o){"use strict";cc._RF.push(e,"967feni+ZhHe7rUImv0CA04","SceneStart");var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),n=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.onButtonStartClick=function(){cc.director.loadScene("game")},e=n([i],e)}(cc.Component);o.default=c,cc._RF.pop()},{}]},{},["SceneFinish","Block","BlocksManager","Field","GameModel","MainContainer","Menu","Progress","SceneGame","Model","SceneStart"]);